import{r as g,j as e,a as w,b as y,f as N,q as S}from"./app-AIDFTJRs.js";import{A as v}from"./AuthenticatedLayout-DBkp5rbV.js";import{P as k}from"./Pagination-tbgjxAT8.js";import"./ApplicationLogo-CSuGBocz.js";import"./transition-B4OsJkZg.js";const O=({orders:c})=>{const[d,u]=g.useState({}),[l,o]=g.useState(c.data),[j,b]=g.useState({}),x=s=>{N.get(s,{},{preserveScroll:!0})},t=async s=>{u(a=>({...a,[s]:!0}));try{const a=await y.get(`/order/status/${s}`);a.data.success&&o(n=>n.map(r=>r.id===s?{...r,payment_status:a.data.order.payment_status}:r))}catch(a){console.error(`Failed to check status for order ${s}:`,a)}finally{u(a=>({...a,[s]:!1}))}},i=async(s,a)=>{b(n=>({...n,[s]:!0}));try{(await y.patch(`/order/${s}/shipping`,{shipping_status:a})).data.success&&o(r=>r.map(p=>p.id===s?{...p,shipping_status:a}:p))}catch(n){console.error(`Failed to update shipping status for order ${s}:`,n)}finally{b(n=>({...n,[s]:!1}))}},f=async()=>{const s=l.filter(h=>h.payment_status==="pending"),a={};s.forEach(h=>{a[h.id]=!0}),u(a);const n=s.map(h=>y.get(`/order/status/${h.id}`).then(m=>m.data.success?{id:h.id,data:m.data.order}:null).catch(m=>(console.error(`Failed to check status for order ${h.id}:`,m),null))),r=await Promise.all(n),p=[...l];r.forEach(h=>{if(h){const m=p.findIndex(_=>_.id===h.id);m!==-1&&(p[m]={...p[m],payment_status:h.data.payment_status})}}),o(p),u({})};return e.jsxs(v,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight",children:"Order Management"}),l.some(s=>s.payment_status==="pending")&&e.jsx("button",{className:"btn btn-sm btn-outline",onClick:f,children:"Refresh Pending Orders"})]}),children:[e.jsx(w,{title:"Orders - Admin"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("table",{className:"table table-zebra w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order ID"}),e.jsx("th",{children:"Customer Name"}),e.jsx("th",{children:"Total Payment"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shipping Address"}),e.jsx("th",{children:"Shipping Status"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.user?s.user.name:"Unknown"}),e.jsx("td",{children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(s.total_payment)}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`badge ${C(s.payment_status)}`,children:s.payment_status}),s.payment_status==="pending"&&e.jsx("button",{className:"btn btn-xs btn-ghost btn-circle",onClick:()=>t(s.id),disabled:d[s.id],children:d[s.id]?e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})}),e.jsx("td",{children:new Date(s.created_at).toLocaleString("id-ID",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{children:s.shipping_address}),e.jsxs("td",{children:[e.jsxs("div",{className:"dropdown",children:[e.jsx("label",{tabIndex:0,className:`btn btn-sm ${s.shipping_status==="pending"?"btn-warning":s.shipping_status==="shipped"?"btn-info":"btn-success"}`,children:s.shipping_status.charAt(0).toUpperCase()+s.shipping_status.slice(1)}),e.jsxs("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52",children:[e.jsx("li",{children:e.jsx("button",{className:`${s.shipping_status==="pending"?"font-bold text-warning":""}`,onClick:()=>i(s.id,"pending"),children:"Pending"})}),e.jsx("li",{children:e.jsx("button",{className:`${s.shipping_status==="shipped"?"font-bold text-info":""}`,onClick:()=>i(s.id,"shipped"),children:"Shipped"})}),e.jsx("li",{children:e.jsx("button",{className:`${s.shipping_status==="delivered"?"font-bold text-success":""}`,onClick:()=>i(s.id,"delivered"),children:"Delivered"})})]})]}),j[s.id]&&e.jsx("span",{className:"loading loading-spinner loading-xs ml-2"})]})]},s.id))})]}),l.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"No orders found"})}),e.jsx(k,{links:c.links,className:"mt-6",onPageChange:x})]})})})})]})},C=c=>{switch(c){case"success":return"badge-success";case"pending":return"badge-warning";case"failed":return"badge-error";case"challenge":return"badge-info";default:return"badge-ghost"}},P=({orders:c})=>{const[d,u]=g.useState(c.data),[l,o]=g.useState({}),j=t=>{N.get(t,{},{preserveScroll:!0})};g.useEffect(()=>{d.filter(i=>i.payment_status==="pending").length>0&&x()},[]);const b=async t=>{o(i=>({...i,[t]:!0}));try{const i=await y.get(`/order/status/${t}`);i.data.success&&u(f=>f.map(s=>s.id===t?{...s,payment_status:i.data.order.payment_status}:s))}catch(i){console.error(`Failed to check status for order ${t}:`,i)}finally{o(i=>({...i,[t]:!1}))}},x=async()=>{const t=d.filter(n=>n.payment_status==="pending"),i={};t.forEach(n=>{i[n.id]=!0}),o(i);const f=t.map(n=>y.get(`/order/status/${n.id}`).then(r=>r.data.success?{id:n.id,data:r.data.order}:null).catch(r=>(console.error(`Failed to check status for order ${n.id}:`,r),null))),s=await Promise.all(f),a=[...d];s.forEach(n=>{if(n){const r=a.findIndex(p=>p.id===n.id);r!==-1&&(a[r]={...a[r],payment_status:n.data.payment_status})}}),u(a),o({})};return e.jsxs(v,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight",children:"Your Orders"}),d.some(t=>t.payment_status==="pending")&&e.jsx("button",{className:"btn btn-sm btn-outline",onClick:x,children:"Refresh Orders"})]}),children:[e.jsx(w,{title:"Your Orders"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("table",{className:"table table-zebra w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order ID"}),e.jsx("th",{children:"Total Payment"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Shipping Status"}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:d.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.id}),e.jsx("td",{children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(t.total_payment)}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`badge ${$(t.payment_status)}`,children:t.payment_status}),t.payment_status==="pending"&&e.jsx("button",{className:"btn btn-xs btn-ghost btn-circle",onClick:()=>b(t.id),disabled:l[t.id],children:l[t.id]?e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${D(t.shipping_status)}`,children:t.shipping_status})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>N.get(`/order/${t.id}`),children:"View"})})]},t.id))})]}),d.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"You haven't placed any orders yet"})}),e.jsx(k,{links:c.links,className:"mt-6",onPageChange:j})]})})})})]})},$=c=>{switch(c){case"success":return"badge-success";case"pending":return"badge-warning";case"failed":return"badge-error";case"expired":return"badge-error";case"cancelled":return"badge-error";case"challenge":return"badge-info";case"settlement":return"badge-success";default:return"badge-ghost"}},D=c=>{switch(c){case"delivered":return"badge-success";case"shipped":return"badge-info";case"pending":return"badge-warning";case"cancelled":return"badge-error";default:return"badge-ghost"}};function H(){const{auth:c,userRole:d,orders:u,error:l}=S().props,o=d||c.user.role,[j,b]=g.useState(u);if(l)return e.jsxs(e.Fragment,{children:[e.jsx(w,{title:"Order Error"}),e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[e.jsx("strong",{children:"Error:"})," ",l]})})]});const x=j||u;return o==="admin"?e.jsx(O,{orders:x}):o==="customer"?e.jsx(P,{orders:x}):e.jsxs(e.Fragment,{children:[e.jsx(w,{title:"Unauthorized"}),e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[e.jsx("strong",{children:"Error:"})," You don't have permission to access this page."]})})]})}export{H as default};
